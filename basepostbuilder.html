<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Base Post Generator - Pixel Perfect</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  background: #f5f5f5;
  padding: 32px;
  display: flex;
  justify-content: center;
}

main {
  display: flex;
  gap: 24px;
  flex-wrap: wrap;
  width: 100%;
  max-width: 1200px;
}

.panel {
  flex: 0 0 360px;
  background: #fff;
  border-radius: 16px;
  padding: 16px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
  max-height: 90vh;
  overflow-y: auto;
}

.section { margin-bottom: 20px; }
.section h3 {
  margin-top: 0;
  font-size: 16px;
  font-weight: 600;
  border-bottom: 1px solid #ddd;
  padding-bottom: 4px;
  margin-bottom: 8px;
}

label { font-size: 13px; font-weight: 600; display: block; margin-top: 8px; }

input, textarea, select { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid #ccc; font-size: 14px; }
textarea { min-height: 80px; }

.selector { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 8px; }
.selector img {
  width: 100%;
  border-radius: 8px;
  border: 2px solid transparent;
  cursor: pointer;
  transition: all 0.2s;
}
.selector img:hover { transform: scale(1.05); }
.selector img.selected { border-color: #1da1f2; box-shadow: 0 0 8px rgba(29,161,242,0.5); }

.preview-wrapper {
  flex: 1 1 600px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.card { width: 100%; max-width: 600px; height: auto; margin-bottom: 16px; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 16px rgba(0,0,0,0.1); }

button {
  padding: 10px 16px;
  background: #1da1f2;
  color: #fff;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  width: 100%;
  margin-top: 8px;
  transition: 0.2s;
}
button:hover { opacity: 0.9; }

.slider-wrapper { display: flex; align-items: center; gap: 8px; }
.slider-wrapper span { width: 32px; text-align: center; font-size: 13px; }

@font-face {
  font-family: 'Inter';
  src: url('assets/fonts/Inter-Regular.woff2') format('woff2');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}
@font-face {
  font-family: 'IBM Plex Sans';
  src: url('assets/fonts/IBMPlexSans-Regular.woff2') format('woff2');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}
@font-face {
  font-family: 'Space Grotesk';
  src: url('assets/fonts/SpaceGrotesk-Regular.woff2') format('woff2');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}
@font-face {
  font-family: 'DM Sans';
  src: url('assets/fonts/DMSans-Regular.woff2') format('woff2');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}
</style>
</head>

<body>
<main>

<!-- PAINEL -->
<section class="panel">
  <h2>Base Post Generator</h2>

  <div class="section">
    <h3>User Logo / PFP</h3>
    <input type="file" id="userLogoInput" accept="image/*">
    <label>Width (px)</label>
    <input type="number" id="userLogoWidth" value="100" min="20" max="300">
    <label>Height (px)</label>
    <input type="number" id="userLogoHeight" value="100" min="20" max="300">
  </div>

  <div class="section">
    <h3>Headline</h3>
    <label>Text</label>
    <input id="headline" placeholder="Building for builders">
    <label>Color</label>
    <input type="color" id="headlineColor" value="#ffffff">
    <label>Size</label>
    <div class="slider-wrapper">
      <input type="range" id="headlineSize" min="24" max="100" value="48">
      <span id="headlineSizeValue">48</span>
    </div>
  </div>

  <div class="section">
    <h3>Body</h3>
    <label>Text</label>
    <textarea id="body" placeholder="Composable tools for the Base ecosystem. Use Shift+Enter for line breaks."></textarea>
    <label>Color</label>
    <input type="color" id="bodyColor" value="#ffffff">
    <label>Size</label>
    <div class="slider-wrapper">
      <input type="range" id="bodySize" min="14" max="60" value="28">
      <span id="bodySizeValue">28</span>
    </div>
  </div>

  <div class="section">
    <h3>Footer</h3>
    <input id="footer" placeholder="Permissionless by design">
    <label>Color</label>
    <input type="color" id="footerColor" value="#ffffff">
    <label>Size</label>
    <div class="slider-wrapper">
      <input type="range" id="footerSize" min="10" max="40" value="16">
      <span id="footerSizeValue">16</span>
    </div>
  </div>

  <div class="section">
    <h3>Fonts</h3>
    <label>Headline Font</label>
    <select id="headlineFont">
      <option value="Inter">Inter</option>
      <option value="IBM Plex Sans">IBM Plex Sans</option>
      <option value="Space Grotesk">Space Grotesk</option>
      <option value="DM Sans">DM Sans</option>
      <option value="system-ui">System UI</option>
    </select>
    <label>Body Font</label>
    <select id="bodyFont">
      <option value="Inter">Inter</option>
      <option value="IBM Plex Sans">IBM Plex Sans</option>
      <option value="Space Grotesk">Space Grotesk</option>
      <option value="DM Sans">DM Sans</option>
      <option value="system-ui">System UI</option>
    </select>
  </div>

  <div class="section">
    <h3>Template</h3>
    <div class="selector" id="templateSelector"></div>
  </div>

  <div class="section">
    <h3>Logo</h3>
    <div class="selector" id="logoSelector"></div>
    <label>Logo Position</label>
    <select id="logoPosition">
      <option value="bottom-right">Bottom Right</option>
      <option value="bottom-left">Bottom Left</option>
      <option value="bottom-center">Bottom Center</option>
    </select>
  </div>
</section>

<!-- PREVIEW -->
<section class="preview-wrapper">
  <div class="card">
    <svg
      id="svgCard"
      viewBox="0 0 1000 1000"
      width="1000"
      height="1000"
      preserveAspectRatio="xMidYMid meet"
    >
      <rect x="0" y="0" width="1000" height="1000" fill="#fff"/>
      <image id="svgTemplate" href="assets/templates/blue.svg" x="0" y="0" width="1000" height="1000"/>
      <image id="svgUserLogo" x="450" y="100" width="100" height="100" href="" />
      <text id="svgHeadline" x="500" y="260" text-anchor="middle" font-size="48" font-weight="700" fill="#fff" font-family="Inter">Building for builders</text>
      <text id="svgBody" x="500" y="330" text-anchor="middle" font-size="28" fill="#fff" font-family="Inter, system-ui"></text>
      <text id="svgFooter" x="500" y="820" text-anchor="middle" font-size="16" fill="#fff" opacity="0.75" font-family="Inter">Permissionless by design</text>
      <image id="svgLogo" x="720" y="780" width="160" height="160"/>
    </svg>
  </div>

  <button id="sharePNG" style="max-width:600px; margin-top:16px;">Share PNG</button>
</section>

<script>
// CONFIG
const FONT_MAP = {
  "Inter": { family: "Inter", file: "assets/fonts/Inter-Regular.woff2" },
  "IBM Plex Sans": { family: "IBM Plex Sans", file: "assets/fonts/IBMPlexSans-Regular.woff2" },
  "Space Grotesk": { family: "Space Grotesk", file: "assets/fonts/SpaceGrotesk-Regular.woff2" },
  "DM Sans": { family: "DM Sans", file: "assets/fonts/DMSans-Regular.woff2" },
  "system-ui": null
};

async function embedFontInSVG(svg, fontKey) {
  const font = FONT_MAP[fontKey];
  if (!font) return;

  const response = await fetch(font.file);
  const buffer = await response.arrayBuffer();
  const base64 = btoa(
    new Uint8Array(buffer).reduce((data, byte) => data + String.fromCharCode(byte), "")
  );

  const style = document.createElementNS("http://www.w3.org/2000/svg", "style");
  style.textContent = `
    @font-face {
      font-family: '${font.family}';
      src: url('data:font/woff2;base64,${base64}') format('woff2');
      font-weight: normal;
      font-style: normal;
    }
    text { font-family: '${font.family}'; }
  `;
  svg.insertBefore(style, svg.firstChild);
}

const templates = ["assets/templates/blue.svg","assets/templates/black.svg","assets/templates/blackandblue.svg","assets/templates/blackandwhite.svg"];
const templateTextColors = {
  "assets/templates/blue.svg":"#ffffff",
  "assets/templates/black.svg":"#ffffff",
  "assets/templates/blackandblue.svg":"#ffffff",
  "assets/templates/blackandwhite.svg":"#000000"
};
const logos = ["assets/logos/Base_blue.svg","assets/logos/Base_black.svg","assets/logos/Base_white.svg","assets/logos/Base_blue2.svg","assets/logos/Base_black2.svg","assets/logos/Base_white2.svg"];
const logoPositions = { "bottom-right":{x:720,y:780}, "bottom-left":{x:120,y:780}, "bottom-center":{x:420,y:780} };

// ELEMENTS
const svgHeadline=document.getElementById("svgHeadline");
const svgBody=document.getElementById("svgBody");
const svgFooter=document.getElementById("svgFooter");
const svgLogo=document.getElementById("svgLogo");
const svgTemplate=document.getElementById("svgTemplate");
const svgCard=document.getElementById("svgCard");
const userLogoInput=document.getElementById("userLogoInput");
const svgUserLogo=document.getElementById("svgUserLogo");
const userLogoWidth=document.getElementById("userLogoWidth");
const userLogoHeight=document.getElementById("userLogoHeight");
let currentHeadlineFont="Inter";
let currentBodyFont="Inter";

// UPLOAD USER LOGO
userLogoInput.onchange=e=>{
  const file=e.target.files[0];
  if(!file) return;
  const reader=new FileReader();
  reader.onload=()=> {
    svgUserLogo.setAttribute("href",reader.result);
    svgUserLogo.setAttribute("x",500-parseFloat(svgUserLogo.getAttribute("width"))/2);
  };
  reader.readAsDataURL(file);
};
userLogoWidth.oninput=e=>{ svgUserLogo.setAttribute("width",e.target.value); svgUserLogo.setAttribute("x",500-parseFloat(svgUserLogo.getAttribute("width"))/2);}
userLogoHeight.oninput=e=>svgUserLogo.setAttribute("height",e.target.value);

// INIT TEMPLATES
const templateSelector=document.getElementById("templateSelector");
templates.forEach((src,i)=>{
  const img=document.createElement("img");
  img.src=src;
  img.onclick=()=>{svgTemplate.setAttribute("href",src); selectItem(templateSelector,img); applyTemplateTextColor(src);}
  if(i===0) img.classList.add("selected");
  templateSelector.appendChild(img);
});

// INIT LOGOS
const logoSelector=document.getElementById("logoSelector");
logos.forEach((src,i)=>{
  const img=document.createElement("img");
  img.src=src;
  img.onclick=()=>{ svgLogo.setAttribute("href",src); selectItem(logoSelector,img);}
  if(i===0){ svgLogo.setAttribute("href",src); img.classList.add("selected");}
  logoSelector.appendChild(img);
});

// LOGO POSITION
const logoPositionSelect=document.getElementById("logoPosition");
logoPositionSelect.onchange=e=>{
  const p=logoPositions[e.target.value];
  svgLogo.setAttribute("x",p.x);
  svgLogo.setAttribute("y",p.y);
};
logoPositionSelect.value="bottom-right";
svgLogo.setAttribute("x",720);
svgLogo.setAttribute("y",780);

// AUX
function selectItem(container,el){ [...container.children].forEach(i=>i.classList.remove("selected")); el.classList.add("selected");}
function applyTemplateTextColor(templateSrc){
  const color=templateTextColors[templateSrc]||"#ffffff";
  svgHeadline.setAttribute("fill",color);
  svgFooter.setAttribute("fill",color);
  [...svgBody.querySelectorAll("tspan")].forEach(tspan=>tspan.setAttribute("fill",color));
  document.getElementById("headlineColor").value=color;
  document.getElementById("bodyColor").value=color;
  document.getElementById("footerColor").value=color;
}

// FONT EMBED
async function embedFontInSVG(svg, fontKey, selector) {
  const font = FONT_MAP[fontKey];
  if (!font) return;

  const response = await fetch(font.file);
  const buffer = await response.arrayBuffer();
  const base64 = btoa(new Uint8Array(buffer).reduce((data, byte) => data + String.fromCharCode(byte), ""));

  const style = document.createElementNS("http://www.w3.org/2000/svg", "style");
  style.textContent = `
    @font-face {
      font-family: '${font.family}';
      src: url('data:font/woff2;base64,${base64}') format('woff2');
      font-weight: normal;
      font-style: normal;
    }
    ${selector} { font-family: '${font.family}'; }
  `;
  svg.insertBefore(style, svg.firstChild);
}

// UPDATE SVG PREVIEW
async function updateSvgFontPreview(){
  svgCard.querySelectorAll("style[data-embedded-font]").forEach(s=>s.remove());
  if(FONT_MAP[currentHeadlineFont]) await embedFont(svgCard,currentHeadlineFont);
  if(FONT_MAP[currentBodyFont]) await embedFont(svgCard,currentBodyFont);
  svgHeadline.setAttribute("font-family",currentHeadlineFont);
  svgFooter.setAttribute("font-family",currentBodyFont);
  [...svgBody.querySelectorAll("tspan")].forEach(tspan=>tspan.setAttribute("font-family",currentBodyFont));
}

// INPUTS
document.getElementById("headline").oninput=e=>{ svgHeadline.textContent=e.target.value; svgHeadline.setAttribute("font-family",currentHeadlineFont);}
document.getElementById("body").oninput=e=>{
  const lines=e.target.value.split("\n");
  svgBody.innerHTML="";
  const color=document.getElementById("bodyColor").value;
  const fontSize=parseInt(document.getElementById("bodySize").value);
  lines.forEach((line,i)=>{
    const tspan=document.createElementNS("http://www.w3.org/2000/svg","tspan");
    tspan.setAttribute("x","500");
    tspan.setAttribute("dy",i===0?"0":fontSize*1.2);
    tspan.setAttribute("fill",color);
    tspan.setAttribute("font-size",fontSize);
    tspan.setAttribute("font-family",currentBodyFont);
    tspan.textContent=line;
    svgBody.appendChild(tspan);
  });
};
document.getElementById("footer").oninput=e=>{ svgFooter.textContent=e.target.value; svgFooter.setAttribute("font-family",currentBodyFont);}
document.getElementById("headlineFont").onchange=async e=>{ currentHeadlineFont=e.target.value; await updateSvgFontPreview();}
document.getElementById("bodyFont").onchange=async e=>{ currentBodyFont=e.target.value; await updateSvgFontPreview();}
document.getElementById("headlineColor").oninput=e=>svgHeadline.setAttribute("fill",e.target.value);
document.getElementById("bodyColor").oninput=e=>[...svgBody.querySelectorAll("tspan")].forEach(tspan=>tspan.setAttribute("fill",e.target.value));
document.getElementById("footerColor").oninput=e=>svgFooter.setAttribute("fill",e.target.value);
document.getElementById("headlineSize").oninput=e=>{ svgHeadline.setAttribute("font-size",e.target.value); document.getElementById("headlineSizeValue").textContent=e.target.value;};
document.getElementById("bodySize").oninput=e=>{ [...svgBody.querySelectorAll("tspan")].forEach(tspan=>tspan.setAttribute("font-size",e.target.value)); document.getElementById("bodySizeValue").textContent=e.target.value;};
document.getElementById("footerSize").oninput=e=>{ svgFooter.setAttribute("font-size",e.target.value); document.getElementById("footerSizeValue").textContent=e.target.value;};

// SHARE PNG
document.getElementById("sharePNG").onclick=async()=>{
  try{
    await document.fonts.ready;
    await updateSvgFontPreview();
    await embedFontInSVG(svgCard, currentHeadlineFont, "#svgHeadline");
    await embedFontInSVG(svgCard, currentBodyFont, "#svgBody tspan");
    await embedFontInSVG(svgCard, currentBodyFont, "#svgFooter");

    // inline imagens
    const images=svgCard.querySelectorAll("image");
    for(const img of images){
      const href=img.getAttribute("href");
      if(!href||href.startsWith("data:")) continue;
      const res=await fetch(href);
      const blob=await res.blob();
      const reader=new FileReader();
      const dataUrl=await new Promise(resolve=>{ reader.onload=()=>resolve(reader.result); reader.readAsDataURL(blob); });
      img.setAttribute("href",dataUrl);
    }

    // serialize SVG
    const serializer=new XMLSerializer();
    const svgStr=serializer.serializeToString(svgCard);
    const blob=new Blob([svgStr],{type:"image/svg+xml;charset=utf-8"});
    const url=URL.createObjectURL(blob);
    const img=new Image();
    img.onload=()=>{
      const canvas=document.createElement("canvas");
      canvas.width=1000;
      canvas.height=1000;
      canvas.getContext("2d").drawImage(img,0,0);
      URL.revokeObjectURL(url);
      const win=window.open();
      win.document.write(`<img src="${canvas.toDataURL("image/png")}" />`);
    };
    img.src=url;
  }catch(err){console.error(err); alert("Erro ao gerar PNG â€” veja o console");}
};

// DRAG USER LOGO
let isDragging=false, offsetY=0;
svgUserLogo.addEventListener("mousedown", e=>{ isDragging=true; offsetY=e.clientY-parseFloat(svgUserLogo.getAttribute("y")); svgUserLogo.style.cursor="grabbing"; });
window.addEventListener("mousemove", e=>{ if(!isDragging) return; let newY=e.clientY-offsetY; if(newY<0)newY=0; if(newY>900)newY=900; svgUserLogo.setAttribute("y",newY); svgUserLogo.setAttribute("x",500-parseFloat(svgUserLogo.getAttribute("width"))/2); });
window.addEventListener("mouseup", ()=>{ isDragging=false; svgUserLogo.style.cursor="grab"; });
</script>
</body>
</html>
